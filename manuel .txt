#
###########################################################################################################
Il y a 2 parties : 

1) L'alignement 
2) l'analyse R


1) L'alignement necessite d'installer wsl ubuntu, qui simule linux sur windows.
Dans ce linux ubuntu, on va ensuite installer conda, qui permet de créer des envrionnements
reproductible avec des outils dont on aura besoin pour l'alignement.
Les outils :


samtools=1.13     >staitsiques alignements, et transformation de fichiers sam en bam, trie, et fixe les alignements
minimap2=2.22     >alignement des shorts reads pair end illumina au genome
surhisat2=2.2.1   >alignement des long read single end nanopore au genome
subread=2.0.1     >creation d'un tableau du nbr de reads par genes pour chaques alignement
sra-tools=3.2.1   >telechargement sra
trinity=2.15.1    >Assemblage de transcriptome pour controle qualité du nbr de contigs assemblé


(Les outils ne sont pas dispo sur anaconda.navigator, il faut obligatoirement passer par un linux, meme simulé sur windows avec wsl).
Une fois les outils installé, on va creer un autre environnement conda avec jupyter-notebook,
permettant d'ouvrir les  script "ILLUMINA.ipynb" et "NANOPORE.ipynb" detaillé avec toute les etapes de l'alignement, et de l'executer ligne par ligne.


2) L'analyse R necessite d'installer anaconda.navigator et de creer un environnement conda contenant R 4.5.1 
On installera ensuite jupyter-notebook permettant d'ouvrir un script R detaillé avec toute les etapes de l'analyse, et de l'executer ligne par ligne.

###########################################################################################################

1) L'alignement 

a) installer wsl dans un terminal de commande windows :
"""
    wsl --install
    wsl --install -d Ubuntu
    wsl
"""

b)Cela ouvrira un terminal de commande ubuntu, proposera de creer un identifiant et un mot de passe ubuntu.
Une fois le terminal ubuntu ouvert vous pourrez installer conda :
""""
    https://www.anaconda.com/docs/getting-started/miniconda/install#linux
    mkdir -p ~/miniconda3
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda3/miniconda.sh
    bash ~/miniconda3/miniconda.sh -b -u -p ~/miniconda3
    rm ~/miniconda3/miniconda.sh
    source ~/miniconda3/bin/activate
    conda init --all
"""


c) Une fois conda installé, vous aurez à droite de votre nom dans ubuntu (base) qui appariatra.
Vous pourrez ensuite creer un environnement conda contenant les outils : "TOOLS_env".
"""
    conda create --yes -n TOOLS_env -c bioconda -c conda-forge \
      samtools=1.13 \
      minimap2=2.22 \
      hisat2=2.2.1 \
      subread=2.0.1 \
      sra-tools=3.2.1 \
      trinity=2.15.1
""""

vous pouvez verifier que l'environnement conda contient tout les outils en l'activant :
"""
      conda activate TOOLS_env 
"""
puis en testant les lignes de commandes de chaque outils (samtools, minimap2,hisat2,etc ..)
pour desacxtiver cet envrionnement conda faites :

"""
    conda deactivate
"""

Si jamais l'envionnement ne contient pas tout les outils, ou a été mal installé,
il est possible de la supprimer avec la commande :


"""
    conda remove --name NOM_DE_L_ENVIRONNEMENT --all
"""


d)Nous allons ensuite creer un 2eme environnement conda contenant jupyter-notebook :

"""
conda create -n jupyter_env -c conda-forge python=3.11 notebook bash_kernel
conda activate jupyter_env
python -m bash_kernel.install
"""

Il est ensuite possible d'ouvrir jupyter notebook avec la commande :
"""
    jupyter notebook
"""

Des lignes vont appraitre dans le terminal, il faut reperer le lien http à ouvrir :

    To access the server, open this file in a browser:
        file:///home/mboissac/.local/share/jupyter/runtime/jpserver-4214-open.html
    Or copy and paste one of these URLs:
        http://localhost:8889/tree?token=a190174bcce9bd01d2ee3934e467d12df3627c094af67502    <  ouvrir celui la
        http://127.0.0.1:8889/tree?token=a190174bcce9bd01d2ee3934e467d12df3627c094af67502

Une fois le jupyter notebook ouvert dans le navigateur,
Ouvrir ensuite le script ILLUMINA.ipynb ou NANOPORE.ipynb selon l'analyse, la suite concernant l'alignement sera detaillé dans chacun des scripts.



###########################################################################################################
2) L'analyse R

Pour analyser un tableau de sortie de FeatureCounts (alignements vs genome) :

Etape 1 : Ouvrir Anaconda.navigator et aller dans Home, ouvrir anaconda prompt

Etape2 : Un terminal de commande va s'ouvrir avec conda , taper les lignes de commandes suivantes une par une:
(faire yes, y ,oui , O, si c'est demandé lors de l'installation)

"""
    conda create -n r451_env -c conda-forge -c anaconda r-base=4.5.1 notebook
    conda activate r451_env 
    R
    install.packages("IRkernel")    #choisir un cran  , ex : 1
    IRkernel::installspec(name = 'ir-r451', displayname = 'R 4.5.1')
"""

etape 3 : quitter le terminal de commande, aller dans enviornnement, verifier que l'environnement "r451_env" a bien été créer, et cliquer sur l'environnement.

etape 4 :  retrouner sur Home, et installer jupyter notebook, puis lancer le.

etape 5 : Ouvrir le jupyter notebook script.ipynb qui doit etre dans le meme reperotire que le dossier FICHIERS_TXT

etape 6 : lancer le jupyter notebook case par case, un dossier OUTPUT va etre créer avec les résultats, graphs, et plot à l'intérieur.